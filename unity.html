<link rel="import" href="bower_components/polymer/polymer.html">

<polymer-element name='unity-web-player' attributes='source name width height'>
<template>

<style type="text/css">
    #container {
        font-family: Helvetica, Verdana, Arial, sans-serif;
        background-color: white;
        color: black;
        text-align: center;
        height: {{ height }}px;
        width: {{ width }}px;
    }
    .header {
        font-weight: 400;
    }
    div.content {
        margin: auto;
        width: {{ width }}px;
    }
    div#broken,
    div#missing {
        margin: auto;
        position: relative;
        top: 50%;
        width: 193px;
    }
    div#broken a,
    div#missing a {
        height: 63px;
        position: relative;
        top: -31px;
    }
    div#broken img,
    div#missing img {
        border-width: 0px;
    }
    div#broken {
        display: none;
    }
    div#unityPlayer {
        cursor: default;
        height: {{ height }}px;
        width: {{ width }}px;
        border: 1px solid #eee;
    }
</style>
<div id="container">
    <h4 class="header">{{ name }}</h4>
    <div class="content">
        <div id="unityPlayer">
            <div id="missing">
                <a href="http://unity3d.com/webplayer/" title="Unity Web Player. Install now!">
                    <img alt="Unity Web Player. Install now!" src="http://webplayer.unity3d.com/installation/getunity.png" width="193" height="63" />
                </a>
            </div>
            <div id="broken">
                <a href="http://unity3d.com/webplayer/" title="Unity Web Player. Install now! Restart your browser after install.">
                    <img alt="Unity Web Player. Install now! Restart your browser after install." src="http://webplayer.unity3d.com/installation/getunityrestart.png" width="193" height="63" />
                </a>
            </div>
        </div>
    </div>
</div>
</template>
<script>
    Polymer({
      source  : ''
    , name    : ''
    , width   : 980
    , height  : 465
    , ready   : function(){

        var unityPlayer = this.$.unityPlayer;
        var source      = this.source;

        var $missingScreen = this.$.missing;
        var $brokenScreen  = this.$.broken;

        $missingScreen.style.display = "none";
        $brokenScreen.style.display = "none";

        var config = {
            width  : this.width
          , height : this.height
          , params : { enableDebugging:"0" }
        };
        var u = new UnityObject2(config, unityPlayer);

        u.observeProgress(function (progress) {
            switch(progress.pluginStatus) {
                case "broken":
                    $brokenScreen.querySelector("a").addEventListener("click", function(e){
                        e.stopPropagation();
                        e.preventDefault();
                        u.installPlugin();
                        return false;
                    });
                    $brokenScreen.style.display = "block";
                    break;
                case "missing":
                    $missingScreen.querySelector("a").addEventListener("click", function(e){
                        e.stopPropagation();
                        e.preventDefault();
                        u.installPlugin();
                        return false;
                    });
                    $missingScreen.style.display = "block";
                    break;
                case "installed":
                    unityPlayer.removeChild($missingScreen);
                    break;
                case "first":
                    break;
            }
        });

        u.initPlugin(unityPlayer, source);

        }
    });
</script>
<script type='text/javascript' src="https://ssl-webplayer.unity3d.com/download_webplayer-3.x/3.0/uo/jquery.min.js"></script>
<script type='text/javascript' src="./UnityObject2.js"></script>

</polymer-element>
